/*
 * source
 * http://stackoverflow.com/questions/11980087/javascript-words-to-numbers
 * with some modifications from
 * http://jesusjzp.github.io/blog/2014/03/06/javascript-number-word-conversion/
 * 
 * note that the jesusjzp.github.io version does not work, as it omits the 
 * "hundred" condition.  But it added some nice case insensitivity and trimming
 * so I started with the stackoverflow version and added those calls.
 */
var Small = {
  'zero': 0,
  'one': 1,
  'two': 2,
  'three': 3,
  'four': 4,
  'five': 5,
  'six': 6,
  'seven': 7,
  'eight': 8,
  'nine': 9,
  'ten': 10,
  'eleven': 11,
  'twelve': 12,
  'thirteen': 13,
  'fourteen': 14,
  'fifteen': 15,
  'sixteen': 16,
  'seventeen': 17,
  'eighteen': 18,
  'nineteen': 19,
  'twenty': 20,
  'thirty': 30,
  'forty': 40,
  'fifty': 50,
  'sixty': 60,
  'seventy': 70,
  'eighty': 80,
  'ninety': 90
};
 
var Magnitude = {
  'hundred':      100,
  'thousand':     1000,
  'million':      1000000,
  'billion':      1000000000,
  'trillion':     1000000000000,
  'quadrillion':  1000000000000000,
  'quintillion':  1000000000000000000,
  'sextillion':   1000000000000000000000,
  'septillion':   1000000000000000000000000,
  'octillion':    1000000000000000000000000000,
  'nonillion':    1000000000000000000000000000000,
  'decillion':    1000000000000000000000000000000000,
};
 
var arr, res, num;

var a, n, g;
var strings = [];
var processing_numbers = false;

function WordsToNumber (s, keep_text) {
    processing_numbers = false;
    if (typeof keep_text === 'undefined')
    {
        keep_text = false;
    }

    if (keep_text)
    {
        strings = [];
    }

    a = s.toString().toLowerCase().trim().split(/[\s-]+/);
    n = 0;
    g = 0;
    a.forEach(feach);

    if (keep_text)
    {
        if (processing_numbers)
        {
            var val = n + g;
            strings.push ("" + val);
        }
        return strings.join (' ');
    }
    else
    {
        return n + g;
    }
}
 
function feach(w) {
    var x = Small[w];
    if (typeof x !== 'undefined')
    {
        processing_numbers = true;
        g = g + x;
    }
    else if (w == "hundred")
    {
        processing_numbers = true;
        g = g * 100;
    }
    else 
    {
        x = Magnitude[w];
        if (typeof x !== 'undefined')
        {
            processing_numbers = true;
            n = n + g * x
            g = 0;
        }
        else 
        { 
            if (processing_numbers)
            {
                var val = n + g;
                strings.push ("" + val);
                n = 0;
            }
            processing_numbers = false;
            strings.push (w);
        }
    }
}

/*
console.log (WordsToNumber ("nineteen hundred forty five"));
console.log (WordsToNumber ("the year was nineteen hundred forty five"));
console.log (WordsToNumber ("the year was nineteen hundred forty five we thought"));

console.log (WordsToNumber ("nineteen hundred forty five", true));
console.log (WordsToNumber ("the year was nineteen hundred forty five", true));
console.log (WordsToNumber ("the year was nineteen hundred forty five we thought", true));
*/

module.exports = WordsToNumber;

